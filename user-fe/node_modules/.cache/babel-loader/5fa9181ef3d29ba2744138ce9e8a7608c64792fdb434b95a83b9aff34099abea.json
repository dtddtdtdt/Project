{"ast":null,"code":"import axios from \"axios\";\nimport jwt_decode from 'jwt-decode';\nconst refreshToken = async () => {\n  try {\n    const res = await axios.post(\"https://server-api-guke.onrender.com/v1/auth/refresh\", {\n      withCredentials: true\n    });\n    return res.data;\n  } catch (err) {\n    console.log(err);\n  }\n};\nexport const createAxios = (user, dispatch, stateSuccess) => {\n  const newInstance = axios.create();\n  newInstance.interceptors.request.use(async config => {\n    let date = new Date();\n    const decodedToken = jwt_decode(user === null || user === void 0 ? void 0 : user.accessToken);\n    if (decodedToken.exp < date.getTime() / 1000) {\n      const data = await refreshToken();\n      const refreshUser = {\n        ...user,\n        accessToken: data.accessToken\n      };\n      dispatch(stateSuccess(refreshUser));\n      config.headers[\"token\"] = \"Bearer \" + data.accessToken;\n    }\n    return config;\n  }, err => {\n    return Promise.reject(err);\n  });\n  return newInstance;\n};","map":{"version":3,"names":["axios","jwt_decode","refreshToken","res","post","withCredentials","data","err","console","log","createAxios","user","dispatch","stateSuccess","newInstance","create","interceptors","request","use","config","date","Date","decodedToken","accessToken","exp","getTime","refreshUser","headers","Promise","reject"],"sources":["D:/TÀI LIỆU HỌC TẬP/Phát triển ứng dụng web/Lý thuyết/WebProject/Project/user-fe/src/instance/createinstance.js"],"sourcesContent":["import axios from \"axios\";\r\nimport jwt_decode from 'jwt-decode';\r\n\r\n\r\n\r\n\r\n\r\nconst refreshToken = async() => {\r\n    try{\r\n        const res = await axios.post(\"https://server-api-guke.onrender.com/v1/auth/refresh\", {\r\n            withCredentials: true,\r\n        });\r\n        return res.data;\r\n    } catch(err) {\r\n        console.log(err);\r\n    }\r\n}\r\n\r\nexport const createAxios = (user, dispatch, stateSuccess) =>{\r\n    const newInstance = axios.create();\r\n    newInstance.interceptors.request.use(\r\n        async(config) =>{\r\n            let date = new Date();\r\n            const decodedToken = jwt_decode(user?.accessToken);\r\n            if(decodedToken.exp < date.getTime() / 1000) {\r\n                const data = await refreshToken();\r\n                const refreshUser = {\r\n                    ...user,\r\n                    accessToken: data.accessToken,\r\n                };\r\n                dispatch(stateSuccess(refreshUser));\r\n                config.headers[\"token\"] = \"Bearer \" + data.accessToken;\r\n            }\r\n            return config;\r\n        },\r\n         (err) => {\r\n            return Promise.reject(err);\r\n         }\r\n    );\r\n    return newInstance;\r\n}"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,UAAU,MAAM,YAAY;AAMnC,MAAMC,YAAY,GAAG,YAAW;EAC5B,IAAG;IACC,MAAMC,GAAG,GAAG,MAAMH,KAAK,CAACI,IAAI,CAAC,sDAAsD,EAAE;MACjFC,eAAe,EAAE;IACrB,CAAC,CAAC;IACF,OAAOF,GAAG,CAACG,IAAI;EACnB,CAAC,CAAC,OAAMC,GAAG,EAAE;IACTC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;EACpB;AACJ,CAAC;AAED,OAAO,MAAMG,WAAW,GAAG,CAACC,IAAI,EAAEC,QAAQ,EAAEC,YAAY,KAAI;EACxD,MAAMC,WAAW,GAAGd,KAAK,CAACe,MAAM,EAAE;EAClCD,WAAW,CAACE,YAAY,CAACC,OAAO,CAACC,GAAG,CAChC,MAAMC,MAAM,IAAI;IACZ,IAAIC,IAAI,GAAG,IAAIC,IAAI,EAAE;IACrB,MAAMC,YAAY,GAAGrB,UAAU,CAACU,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEY,WAAW,CAAC;IAClD,IAAGD,YAAY,CAACE,GAAG,GAAGJ,IAAI,CAACK,OAAO,EAAE,GAAG,IAAI,EAAE;MACzC,MAAMnB,IAAI,GAAG,MAAMJ,YAAY,EAAE;MACjC,MAAMwB,WAAW,GAAG;QAChB,GAAGf,IAAI;QACPY,WAAW,EAAEjB,IAAI,CAACiB;MACtB,CAAC;MACDX,QAAQ,CAACC,YAAY,CAACa,WAAW,CAAC,CAAC;MACnCP,MAAM,CAACQ,OAAO,CAAC,OAAO,CAAC,GAAG,SAAS,GAAGrB,IAAI,CAACiB,WAAW;IAC1D;IACA,OAAOJ,MAAM;EACjB,CAAC,EACCZ,GAAG,IAAK;IACN,OAAOqB,OAAO,CAACC,MAAM,CAACtB,GAAG,CAAC;EAC7B,CAAC,CACL;EACD,OAAOO,WAAW;AACtB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}